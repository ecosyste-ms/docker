<% if @distro %>
  <% @meta_title = "Versions using #{@distro.pretty_name}" %>
  <% @meta_description = "List of Docker images using #{@distro.pretty_name} Linux distribution" %>

  <div class="container-sm">
    <h1>
      <%= link_to 'Distros', distros_path %> : <%= link_to @distro.pretty_name, distro_path(@distro.slug) %> : Versions
    </h1>

    <p class='lead'>
      Docker images using <%= @distro.pretty_name %>
    </p>

    <p>
      <strong><%= number_with_delimiter @distro.versions_count %></strong> <%= 'Docker image'.pluralize(@distro.versions_count) %>
      <% if @distro.total_downloads && @distro.total_downloads > 0 %>
        - <strong><%= number_with_delimiter @distro.total_downloads %></strong> total downloads
      <% end %>
    </p>

    <% @versions.group_by(&:package).each do |package, versions| %>
      <% next if package.nil? %>
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">
            <%= link_to package.name, package_path(package.name) %>
          </h5>

          <% if package.description.present? %>
            <p class="card-text">
              <%= package.description %>
            </p>
          <% end %>

          <p class="small">
            <strong>Versions:</strong>
            <%= versions.map(&:number).join(', ') %>
          </p>

          <small class='text-muted'>
            <% if package.latest_release_published_at %>
              <span title="<%= package.latest_release_published_at %>">Latest release: <%= time_ago_in_words package.latest_release_published_at %> ago</span>
            <% end %>

            <% if package.downloads %>
              - <%= number_with_delimiter package.downloads %> downloads
            <% end %>

            <% if package.dependencies_count %>
              - <%= number_with_delimiter package.dependencies_count %> dependencies
            <% end %>
          </small>
        </div>
      </div>
    <% end %>

    <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>

    <p>
      <%= link_to 'Back to distro', distro_path(@distro.slug), class: 'btn btn-secondary' %>
    </p>
  </div>
<% end %>
